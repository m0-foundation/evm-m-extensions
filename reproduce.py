import re


def convert_to_solidity(call_sequence):
    # Regex patterns to extract the necessary parts
    call_pattern = re.compile(
        r"(?:Fuzz\.)?(\w+\([^\)]*\))(?: from: (0x[0-9a-fA-F]{40}))?(?: Gas: (\d+))?(?: Time delay: (\d+) seconds)?(?: Block delay: (\d+))?"
    )
    wait_pattern = re.compile(
        r"\*wait\*(?: Time delay: (\d+) seconds)?(?: Block delay: (\d+))?"
    )

    solidity_code = "function test_repro() public {\n"

    lines = call_sequence.strip().split("\n")
    last_index = len(lines) - 1

    for i, line in enumerate(lines):
        call_match = call_pattern.search(line)
        wait_match = wait_pattern.search(line)
        if call_match:
            call, from_addr, gas, time_delay, block_delay = call_match.groups()

            # Add prank line if from address exists
            # if from_addr:
            #     solidity_code += f'    vm.prank({from_addr});\n'

            # Add warp line if time delay exists
            if time_delay:
                solidity_code += f"    vm.warp(block.timestamp + {time_delay});\n"

            # Add roll line if block delay exists
            if block_delay:
                solidity_code += f"    vm.roll(block.number + {block_delay});\n"

            if "collateralToMarketId" in call:
                continue

            # Add function call
            if i < last_index:
                solidity_code += f"    try this.{call} {{}} catch {{}}\n"
            else:
                solidity_code += f"    {call};\n"
            solidity_code += "\n"
        elif wait_match:
            time_delay, block_delay = wait_match.groups()

            # Add warp line if time delay exists
            if time_delay:
                solidity_code += f"    vm.warp(block.timestamp + {time_delay});\n"

            # Add roll line if block delay exists
            if block_delay:
                solidity_code += f"    vm.roll(block.number + {block_delay});\n"
            solidity_code += "\n"

    solidity_code += "}\n"

    return solidity_code


# Example usage
call_sequence = """
Fuzz.fuzz_transferFrom_MYieldFee(159346249267936146908319076706960114280907855662381329613047166547631156360) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 38059 seconds Block delay: 36859
Fuzz.fuzz_claimFee_MYieldFee(75237354920017176660087725049684539002040095441541061855114160037098652078185) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 115085 seconds Block delay: 255
Fuzz.fuzz_setClaimRecipient_MYieldFee(52893065819171046290496748641361403530039869606308466328802384875836649946749) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 588255 seconds Block delay: 32
Fuzz.fuzz_SF_replaceAssetWithM(28207756253925222895483684745190116083920957066495696616193332642581591121743,4251529565798873838311791267754427726744069037704701844854721802705796428926,84057622131012944894568017713571819791929080074553474951010028403279674761070,92446554972084850374559700204810717486300077434012343544031280628706106468590,96062724842919116514430154815673282676766913991913241012430501095568133542832) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 225906 seconds Block delay: 38350
Fuzz.fuzz_transferFrom_MYieldFee(159346249267936146908319076706960114280907855662381329613047166547631156360) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 172101 seconds Block delay: 50499
Fuzz.fuzz_JMI_freeze(1524785992,82387068399058324048490805069466185522723028657183672193870387349143072668534) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 444463 seconds Block delay: 4462
Fuzz.fuzz_transferFrom_MYieldToOne(4369999) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 32767 seconds Block delay: 7323
Fuzz.fuzz_enableEarning_MYieldFee(31840222623911873541303114407268032407627550299792610257818316736341251307522) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 154071 seconds Block delay: 20243
Fuzz.fuzz_setYieldRecipient_MYieldToOne(432482942854846834354856175764162158879313950265471) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 448552 seconds Block delay: 1123
Fuzz.fuzz_approve_MYieldFee(30022656646516682079722708968951596291223083030319253464069243349407101041248) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 491013 seconds Block delay: 49415
Fuzz.fuzz_claimYieldFor_MYieldFee(52825553193349136198808047253858555998035981707367051855623458244132483493602) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 478623 seconds Block delay: 15367
Fuzz.fuzz_transfer_MEarnerManager(1524785993) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 440097 seconds Block delay: 59981
Fuzz.fuzz_setFeeRate_MYieldFee(115792089237316195423570985008687907853269984665640564039457584007913129639935) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 444463 seconds Block delay: 53678
Fuzz.fuzz_enableEarning_MYieldFee(819749168853769821620414103450862324241449239111828637559537601513010966180) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 166184 seconds Block delay: 38518
Fuzz.fuzz_SF_setAdminApprovedExtension(49422444666274497680920181554108819891604299159788828991597923688996626236461,55197844581908014904097360686149815924189416996740906854715803708937700458636) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 207289 seconds Block delay: 42088
Fuzz.fuzz_setFeeRate_MYieldFee(43190348632881374301165193948524645429732725937001110017686112739433128539462) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 519847 seconds Block delay: 9920
Fuzz.fuzz_approve_MYieldToOne(25956407913460542151439983583824985801788184072945905015718184561567425749808) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 444463 seconds Block delay: 800
Fuzz.fuzz_JMI_unpause(4370000) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 511822 seconds Block delay: 54155
Fuzz.fuzz_setAccountInfo_MEarnerManager(15993021952213133663529297125256059242986523161531227679857470198951169344792,true) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 478623 seconds Block delay: 54809
Fuzz.fuzz_JMI_pause(1524785992) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 414579 seconds Block delay: 47075
Fuzz.fuzz_claimYieldFor_MYieldFee(25939986657577061537095007240098073255781782164108193273328673484106211393746) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 482712 seconds Block delay: 32147
Fuzz.fuzz_transferFrom_MEarnerManager(4370000) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 332369 seconds Block delay: 55787
Fuzz.fuzz_randomizeConfigs(31135971030476882570525740579020368647960951577454873038437743956128730625997,4369999,58674718677462054367655137744326103084010440658287401403589371685639453893685,1524785993,51364233597295205086321910620095977491390836352237794048550286917480171234490,1246018967157715875490483462624050518878141870633164901974589566055940178124) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 463587 seconds Block delay: 5023
Fuzz.fuzz_warpDays(1524785993) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 136394 seconds Block delay: 36859
Fuzz.fuzz_SF_swap(5307938895182099500425321483815580626661838105883866443861063398264162993867,15987955493967578280260298607783375941856402764619114009213049317193188553111,85615241474574304605288692945504955047543431294971917061010735032976842879920,222882628004772467699410911257663069541045241994502610552706218253833985610) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 512439 seconds Block delay: 59982
Fuzz.fuzz_updateIndex_MYieldFee(0) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 67960 seconds Block delay: 45261
Fuzz.fuzz_transfer_MYieldToOne(1524785993) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 67960 seconds Block delay: 53349
Fuzz.fuzz_JMI_setAssetCap(20188792228968168697699374825889469458110119726938339766030478034622162114,101560332199876909022562543292159496929088462287350170743447875677736233419135) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 289607 seconds Block delay: 33952
Fuzz.fuzz_enableEarning_MYieldFee(6330060) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 209930 seconds Block delay: 9966
Fuzz.fuzz_disableEarning_MYieldToOne(81000917919445093081614616177944325979009567653587541971994978623524305520471) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 225906 seconds Block delay: 49415
Fuzz.fuzz_SF_pause(89320837102079819683872662331340411645965434009094541554182726338351570558167) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 414736 seconds Block delay: 59552
Fuzz.fuzz_transferFrom_MYieldToOne(4370000) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 414736 seconds Block delay: 38100
Fuzz.fuzz_claimFee_MYieldFee(18375895312769826904014248835848180176924413861577930205103535231059096780421) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 492197 seconds Block delay: 34720
Fuzz.fuzz_setFeeRecipient_MYieldFee(1524785991) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 547623 seconds Block delay: 47075
Fuzz.fuzz_claimYieldFor_MYieldFee(115792089237316195423570985008687907853269984665640564039457584007913129639935) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 444463 seconds Block delay: 5237
Fuzz.fuzz_warpDays(4369999) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 33271 seconds Block delay: 38100
Fuzz.fuzz_transferFrom_MYieldToOne(57555731761829341714223885820756950313504956914663888255060468509651509796298) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 271957 seconds Block delay: 5054
Fuzz.fuzz_warpWeeks(793005810657709866712847751731141177972288267) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 255 seconds Block delay: 12493
Fuzz.fuzz_transfer_MYieldFee(200) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 38059 seconds Block delay: 55643
Fuzz.fuzz_transfer_MYieldToOne(1524785993) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 436727 seconds Block delay: 1088
Fuzz.fuzz_SF_pause(115792089237316195423570985008687907853269984665640564039457584007913129639934) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 437838 seconds Block delay: 32767
Fuzz.fuzz_updateIndex_MYieldFee(2018427009) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 397311 seconds Block delay: 53349
Fuzz.fuzz_setFeeRecipient_MYieldFee(72749875129055296468487124930753680606792554144789769053070708077978368924187) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 150273 seconds Block delay: 31232
Fuzz.fuzz_claimFee_MYieldFee(80025046780973345466421277284073547539792232593234925023733512382339896518940) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 166184 seconds Block delay: 30304
Fuzz.fuzz_mint(1524785991) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 588255 seconds Block delay: 5053
Fuzz.fuzz_SF_swap(1524785992,1524785991,4369999,84626504065279567327728870893682743543888914030429916227769472380275468184521) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 588255 seconds Block delay: 38100
Fuzz.fuzz_setAccountInfo_MEarnerManager(15993021952213133663529297125256059242986523161531227679857470198951169344792,true) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 66543 seconds Block delay: 10705
Fuzz.fuzz_claimFee_MYieldFee(94469739881052624682026615435943729912818419879277979846439127965478656984283) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 289607 seconds Block delay: 57086
Fuzz.fuzz_approve_MEarnerManager(179) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 31594 seconds Block delay: 1984
Fuzz.fuzz_approve_MYieldFee(70084078445306674485181776306160431856479695593478992379638974923893801955994) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 66543 seconds Block delay: 58783
Fuzz.fuzz_transfer_MYieldFee(26812837462932155394276652213013694757716137125702950998112999565320940119830) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 31594 seconds Block delay: 59981
Fuzz.fuzz_disableEarning_MYieldToOne(4369999) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 434894 seconds Block delay: 9425
Fuzz.fuzz_transferFrom_MYieldFee(73846073669371984442098610130166094596832443447390620864189382824491437128335) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 112444 seconds Block delay: 15367
Fuzz.fuzz_claimYield_MYieldToOne(113963905455416024186111896836495518081486603576461099452039168928679770520757) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 31594 seconds Block delay: 52558
Fuzz.fuzz_transferFrom_MYieldFee(1524785993) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 338920 seconds Block delay: 11826
Fuzz.fuzz_JMI_freeze(52791067665917092427213459318247618792983698260492979434305131403729664869307,34791538784005052146691082758035569087921013651300583556254510583731033268490) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 136392 seconds Block delay: 16110
Fuzz.fuzz_setYieldRecipient_MYieldToOne(4369999) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 117472 seconds Block delay: 45261
Fuzz.fuzz_JMI_freeze(1524785993,20685854593753816123860388083112554981813874265329684745885989697296795014296) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 132314 seconds Block delay: 12053
Fuzz.fuzz_JMI_unpause(12874688972173550603749600143163094629762374816174936244066646464199457245873) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 275394 seconds Block delay: 22909
Fuzz.fuzz_JMI_setAssetCap(1524785993,218) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 156190 seconds Block delay: 30256
Fuzz.fuzz_transferFrom_MYieldToOne(51329347992329256221747155886732507098107110388911565613478027295138690981656) from: 0x0000000000000000000000000000000000020000 «USER2» Time delay: 361136 seconds Block delay: 11080
Fuzz.fuzz_setFeeRate_MYieldFee(115792089237316195423570985008687907853269984665640564039457584007913129639935) from: 0x0000000000000000000000000000000000010000 «USER1» Time delay: 136392 seconds Block delay: 12155
Fuzz.fuzz_transferFrom_MEarnerManager(115792089237316195423570985008687907853269984665640564039457584007913129639933) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 136394 seconds Block delay: 45261
Fuzz.fuzz_SF_pause(1524785993) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 166184 seconds Block delay: 127
Fuzz.fuzz_SF_swap(45216956302289433450505161972565347080273866440981695996818347403457758457910,595,61664168900900186570446040285321015537384241533475878236697824629360535711385,32607687209752004308266732783906993484182501546477316047950002913793428519799) from: 0x0000000000000000000000000000000000030000 «USER3» Time delay: 400981 seconds Block delay: 15369




"""

solidity_code = convert_to_solidity(call_sequence)
print(solidity_code)
